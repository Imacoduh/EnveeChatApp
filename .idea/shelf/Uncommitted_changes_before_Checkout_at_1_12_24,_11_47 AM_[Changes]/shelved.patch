Index: package.json
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>{\n  \"name\": \"chatbot-ui\",\n  \"version\": \"2.0.0\",\n  \"private\": true,\n  \"scripts\": {\n    \"chat\": \"supabase start && npm run db-types && npm run dev\",\n    \"restart\": \"supabase stop && npm run chat\",\n    \"update\": \"git pull && npm run db-migrate up && npm run db-types\",\n    \"prepare\": \"husky install\",\n    \"clean\": \"npm run lint:fix && npm run format:write\",\n    \"dev\": \"next dev\",\n    \"build\": \"next build\",\n    \"start\": \"next start\",\n    \"lint\": \"next lint\",\n    \"lint:fix\": \"next lint --fix\",\n    \"analyze\": \"ANALYZE=true npm run build\",\n    \"preview\": \"next build && next start\",\n    \"type-check\": \"tsc --noEmit\",\n    \"format:write\": \"prettier --write \\\"{app,lib,db,components,context,types}/**/*.{ts,tsx}\\\" --cache\",\n    \"format:check\": \"prettier --check \\\"{app,lib,db,components,context,types}**/*.{ts,tsx}\\\" --cache\",\n    \"db-reset\": \"supabase db reset && npm run db-types\",\n    \"db-migrate\": \"supabase migration up\",\n    \"db-types\": \"supabase gen types typescript --local > supabase/types.ts\",\n    \"db-pull\": \"supabase db remote commit\",\n    \"db-push\": \"supabase db push\"\n  },\n  \"dependencies\": {\n    \"@anthropic-ai/sdk\": \"^0.12.0\",\n    \"@azure/openai\": \"^1.0.0-beta.8\",\n    \"@google/generative-ai\": \"^0.1.3\",\n    \"@hookform/resolvers\": \"^3.3.2\",\n    \"@mistralai/mistralai\": \"^0.0.8\",\n    \"@radix-ui/react-accordion\": \"^1.1.2\",\n    \"@radix-ui/react-alert-dialog\": \"^1.0.5\",\n    \"@radix-ui/react-aspect-ratio\": \"^1.0.3\",\n    \"@radix-ui/react-avatar\": \"^1.0.4\",\n    \"@radix-ui/react-checkbox\": \"^1.0.4\",\n    \"@radix-ui/react-collapsible\": \"^1.0.3\",\n    \"@radix-ui/react-context-menu\": \"^2.1.5\",\n    \"@radix-ui/react-dialog\": \"^1.0.5\",\n    \"@radix-ui/react-dropdown-menu\": \"^2.0.6\",\n    \"@radix-ui/react-hover-card\": \"^1.0.7\",\n    \"@radix-ui/react-label\": \"^2.0.2\",\n    \"@radix-ui/react-menubar\": \"^1.0.4\",\n    \"@radix-ui/react-navigation-menu\": \"^1.1.4\",\n    \"@radix-ui/react-popover\": \"^1.0.7\",\n    \"@radix-ui/react-progress\": \"^1.0.3\",\n    \"@radix-ui/react-radio-group\": \"^1.1.3\",\n    \"@radix-ui/react-scroll-area\": \"^1.0.5\",\n    \"@radix-ui/react-select\": \"^2.0.0\",\n    \"@radix-ui/react-separator\": \"^1.0.3\",\n    \"@radix-ui/react-slider\": \"^1.1.2\",\n    \"@radix-ui/react-slot\": \"^1.0.2\",\n    \"@radix-ui/react-switch\": \"^1.0.3\",\n    \"@radix-ui/react-tabs\": \"^1.0.4\",\n    \"@radix-ui/react-toast\": \"^1.1.5\",\n    \"@radix-ui/react-toggle\": \"^1.0.3\",\n    \"@radix-ui/react-toggle-group\": \"^1.0.4\",\n    \"@radix-ui/react-tooltip\": \"^1.0.7\",\n    \"@supabase/ssr\": \"^0.0.10\",\n    \"@supabase/supabase-js\": \"^2.38.4\",\n    \"@tabler/icons-react\": \"^2.40.0\",\n    \"@vercel/analytics\": \"^1.1.1\",\n    \"@xenova/transformers\": \"^2.13.4\",\n    \"ai\": \"^2.2.30\",\n    \"class-variance-authority\": \"^0.7.0\",\n    \"cmdk\": \"^0.2.0\",\n    \"d3-dsv\": \"^2.0.0\",\n    \"date-fns\": \"^2.30.0\",\n    \"endent\": \"^2.1.0\",\n    \"gpt-tokenizer\": \"^2.1.2\",\n    \"langchain\": \"^0.0.213\",\n    \"lucide-react\": \"^0.292.0\",\n    \"mammoth\": \"^1.6.0\",\n    \"next\": \"14.0.2\",\n    \"next-themes\": \"^0.2.1\",\n    \"openai\": \"^4.23.0\",\n    \"pdf-parse\": \"^1.1.1\",\n    \"react\": \"^18\",\n    \"react-day-picker\": \"^8.9.1\",\n    \"react-dom\": \"^18\",\n    \"react-hook-form\": \"^7.48.2\",\n    \"react-image-crop\": \"^11.0.1\",\n    \"react-markdown\": \"^9.0.1\",\n    \"react-syntax-highlighter\": \"^15.5.0\",\n    \"react-textarea-autosize\": \"^8.5.3\",\n    \"remark-gfm\": \"^4.0.0\",\n    \"remark-math\": \"^6.0.0\",\n    \"sonner\": \"^1.3.1\",\n    \"uuid\": \"^9.0.1\",\n    \"zod\": \"^3.22.4\"\n  },\n  \"devDependencies\": {\n    \"@next/bundle-analyzer\": \"^14.0.2\",\n    \"@tailwindcss/typography\": \"^0.5.10\",\n    \"@types/node\": \"^20\",\n    \"@types/pdf-parse\": \"^1.1.4\",\n    \"@types/react\": \"^18\",\n    \"@types/react-dom\": \"^18\",\n    \"@types/react-syntax-highlighter\": \"^15.5.11\",\n    \"@types/uuid\": \"^9.0.7\",\n    \"autoprefixer\": \"^10.4.16\",\n    \"clsx\": \"^2.0.0\",\n    \"eslint\": \"^8\",\n    \"eslint-config-next\": \"^14.0.2\",\n    \"eslint-config-prettier\": \"^9.1.0\",\n    \"eslint-plugin-tailwindcss\": \"^3.13.0\",\n    \"husky\": \"^8.0.3\",\n    \"postcss\": \"^8.4.31\",\n    \"prettier\": \"^3.1.0\",\n    \"tailwind-merge\": \"^2.0.0\",\n    \"tailwindcss\": \"^3.3.5\",\n    \"tailwindcss-animate\": \"^1.0.7\",\n    \"typescript\": \"^5\"\n  }\n}\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/package.json b/package.json
--- a/package.json	(revision 90a8540a4e3c51daba362ff57b4dc509453757bd)
+++ b/package.json	(date 1705040541648)
@@ -3,22 +3,22 @@
   "version": "2.0.0",
   "private": true,
   "scripts": {
-    "chat": "supabase start && npm run db-types && npm run dev",
-    "restart": "supabase stop && npm run chat",
-    "update": "git pull && npm run db-migrate up && npm run db-types",
+    "chat": "supabase start && pnpm run db-types && pnpm run dev",
+    "restart": "supabase stop && pnpm run chat",
+    "update": "git pull && pnpm run db-migrate up && pnpm run db-types",
     "prepare": "husky install",
-    "clean": "npm run lint:fix && npm run format:write",
+    "clean": "pnpm run lint:fix && pnpm run format:write",
     "dev": "next dev",
     "build": "next build",
     "start": "next start",
     "lint": "next lint",
     "lint:fix": "next lint --fix",
-    "analyze": "ANALYZE=true npm run build",
+    "analyze": "ANALYZE=true pnpm run build",
     "preview": "next build && next start",
     "type-check": "tsc --noEmit",
     "format:write": "prettier --write \"{app,lib,db,components,context,types}/**/*.{ts,tsx}\" --cache",
     "format:check": "prettier --check \"{app,lib,db,components,context,types}**/*.{ts,tsx}\" --cache",
-    "db-reset": "supabase db reset && npm run db-types",
+    "db-reset": "supabase db reset && pnpm run db-types",
     "db-migrate": "supabase migration up",
     "db-types": "supabase gen types typescript --local > supabase/types.ts",
     "db-pull": "supabase db remote commit",
Index: supabase/migrations/20240108234540_setup.sql
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>-- Enable HTTP extension\ncreate extension http with schema extensions;\n\n-- Enable vector extension\ncreate extension vector with schema extensions;\n\n-- Function to update modified column\nCREATE OR REPLACE FUNCTION update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = now(); \n    RETURN NEW; \nEND;\n$$ language 'plpgsql';\n\n-- Function to delete a message and all following messages\nCREATE OR REPLACE FUNCTION delete_message_including_and_after(\n    p_user_id UUID, \n    p_chat_id UUID, \n    p_sequence_number INT\n)\nRETURNS VOID AS $$\nBEGIN\n    DELETE FROM messages \n    WHERE user_id = p_user_id AND chat_id = p_chat_id AND sequence_number >= p_sequence_number;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Function to create duplicate messages for a new chat\nCREATE OR REPLACE FUNCTION create_duplicate_messages_for_new_chat(old_chat_id UUID, new_chat_id UUID, new_user_id UUID)\nRETURNS VOID AS $$\nBEGIN\n    INSERT INTO messages (user_id, chat_id, content, role, model, sequence_number, tokens, created_at, updated_at)\n    SELECT new_user_id, new_chat_id, content, role, model, sequence_number, tokens, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP\n    FROM messages\n    WHERE chat_id = old_chat_id;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Policy to allow users to read their own files\nCREATE POLICY \"Allow users to read their own files\"\nON storage.objects FOR SELECT\nTO authenticated\nUSING (auth.uid()::text = owner_id::text);\n\n-- Function to delete a storage object\nCREATE OR REPLACE FUNCTION delete_storage_object(bucket TEXT, object TEXT, OUT status INT, OUT content TEXT)\nRETURNS RECORD\nLANGUAGE 'plpgsql'\nSECURITY DEFINER\nAS $$\nDECLARE\n  project_url TEXT := 'http://supabase_kong_chatbotui:8000';\n  service_role_key TEXT := 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImV4cCI6MTk4MzgxMjk5Nn0.EGIM96RAZx35lJzdJsyH-qQwv8Hdp7fsn3W0YpN81IU'; -- full access needed for http request to storage\n  url TEXT := project_url || '/storage/v1/object/' || bucket || '/' || object;\nBEGIN\n  SELECT\n      INTO status, content\n           result.status::INT, result.content::TEXT\n      FROM extensions.http((\n    'DELETE',\n    url,\n    ARRAY[extensions.http_header('authorization','Bearer ' || service_role_key)],\n    NULL,\n    NULL)::extensions.http_request) AS result;\nEND;\n$$;\n\n-- Function to delete a storage object from a bucket\nCREATE OR REPLACE FUNCTION delete_storage_object_from_bucket(bucket_name TEXT, object_path TEXT, OUT status INT, OUT content TEXT)\nRETURNS RECORD\nLANGUAGE 'plpgsql'\nSECURITY DEFINER\nAS $$\nBEGIN\n  SELECT\n      INTO status, content\n           result.status, result.content\n      FROM public.delete_storage_object(bucket_name, object_path) AS result;\nEND;\n$$;
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/supabase/migrations/20240108234540_setup.sql b/supabase/migrations/20240108234540_setup.sql
--- a/supabase/migrations/20240108234540_setup.sql	(revision 90a8540a4e3c51daba362ff57b4dc509453757bd)
+++ b/supabase/migrations/20240108234540_setup.sql	(date 1705041424277)
@@ -50,8 +50,8 @@
 SECURITY DEFINER
 AS $$
 DECLARE
-  project_url TEXT := 'http://supabase_kong_chatbotui:8000';
-  service_role_key TEXT := 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImV4cCI6MTk4MzgxMjk5Nn0.EGIM96RAZx35lJzdJsyH-qQwv8Hdp7fsn3W0YpN81IU'; -- full access needed for http request to storage
+  project_url TEXT := 'https://eavpwewrtymbetgljwtu.supabase.co';
+  service_role_key TEXT := 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVhdnB3ZXdydHltYmV0Z2xqd3R1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDUwNDExMzYsImV4cCI6MjAyMDYxNzEzNn0.sdsq04DvkmFjbYHg3dlPsHBDLnwI35izax-ohBdqrKg'; -- full access needed for http request to storage
   url TEXT := project_url || '/storage/v1/object/' || bucket || '/' || object;
 BEGIN
   SELECT
Index: .gitignore
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+># See https://help.github.com/articles/ignoring-files/ for more about ignoring files.\n\n# dependencies\n/node_modules\n/.pnp\n.pnp.js\n.yarn/install-state.gz\n\n# testing\n/coverage\n\n# next.js\n/.next/\n/out/\n\n# production\n/build\n\n# misc\n.DS_Store\n*.pem\n\n# debug\nnpm-debug.log*\nyarn-debug.log*\nyarn-error.log*\n\n# local env files\n.env\n.env*.local\n\n# vercel\n.vercel\n\n# typescript\n*.tsbuildinfo\nnext-env.d.ts\n\nseed.sql\n.VSCodeCounter
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.gitignore b/.gitignore
--- a/.gitignore	(revision 90a8540a4e3c51daba362ff57b4dc509453757bd)
+++ b/.gitignore	(date 1705040878586)
@@ -29,6 +29,9 @@
 .env
 .env*.local
 
+# dev environment
+.idea/
+
 # vercel
 .vercel
 
